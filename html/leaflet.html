<html>
<head> <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
    crossorigin=""/></head>

<body>

 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>

<div id="map" style="height: 1000px;"></div> <!-- creates a div with an id (DOM id)-->

<script type="text/javascript">
    /*
        L.map creates the map object via a given DOM id, so I can mess with location and stuff via that. 
        this.setView modifies this (the map) and then returns the map with the changed state. This is center and zoom.
    */
    var map = L.map('map').setView([-33.8688, 151.2093], 13); 
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

    //logic goes here
    const apikey = "f643f7e147724981dabe7c004e1b9b03";
    var marker = new L.marker([0, 0]); //invisible marker

    function onMapClick(e) {
        map.removeLayer(marker); //map only ever has a single active marker
        marker = new L.Marker(e.latlng);
        map.addLayer(marker);

        //query weather via OpenWeatherMap API
        var weatherData = new Object();
    
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;
        var url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${apikey}&units=metric`

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const { main, name, sys, weather } = data;
                const icon = `https://openweathermap.org/img/wn/${
                    weather[0]["icon"]
                }@2x.png`;
                
                const markup = ` 
                    <h2 class="city-name" data-name="${name},${sys.country}"> 
                    <span>${name}</span> 
                    <sup>${sys.country}</sup> 
                    </h2> 
                    <div class="city-temp">${Math.round(main.temp)}<sup>Â°C</sup> 
                    </div> 
                    <figure> 
                    <img class="city-icon" src=${icon} alt=${weather[0]["main"]}> 
                    <figcaption>${weather[0]["description"]}</figcaption> 
                    </figure> 
                    `;

                //construct popup
                marker.bindPopup(markup).openPopup();
            })
        .catch(() => {
            alert("fatal error");
        });

    }

    map.on('click', onMapClick);

  </script>
 
</body>

</html>